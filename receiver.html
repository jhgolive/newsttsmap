<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Receiver with Pointer</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
body { margin:0; height:100vh; overflow:hidden; }
#pointer { position:absolute; width:12px; height:20px; background:white;
clip-path: polygon(0 0, 100% 50%, 0 100%, 25% 50%);
pointer-events:none; transition:left 0.05s linear, top 0.05s linear, background 0.1s; z-index:9999; }
#site-container { width:100%; height:100%; overflow:auto; position:relative; }
</style>
</head>
<body>
<div id="site-container"></div>
<div id="pointer"></div>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyAQGtOEcxFxl9FV7NASLgxLDc23u2vzS_0",
  authDomain: "mygps-11798.firebaseapp.com",
  databaseURL: "https://mygps-11798-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "mygps-11798",
  storageBucket: "mygps-11798.appspot.com",
  messagingSenderId: "271371741627",
  appId: "1:271371741627:web:642901f43c5ad57d80bc9e"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const pointerRef = db.ref('pointer');
const pointer = document.getElementById('pointer');
const container = document.getElementById('site-container');

async function loadSite(url) {
  try {
    const res = await fetch(`https://your-railway-app.up.railway.app/proxy/${encodeURIComponent(url)}`);
    let html = await res.text();
    // 상대경로 해결용 <base> 태그 삽입
    html = `<base href="${url}">` + html;
    container.innerHTML = html;
  } catch(err) {
    console.error('사이트 로드 실패:', err);
  }
}

// 원하는 사이트 불러오기
loadSite('https://ainews1.co.kr');

// 포인터 이동 & 클릭
pointerRef.on('value', snapshot => {
  const data = snapshot.val();
  if(!data) return;

  const rect = container.getBoundingClientRect();
  const x = rect.left + data.x * rect.width;
  const y = rect.top + data.y * rect.height;

  pointer.style.left = x+'px';
  pointer.style.top = y+'px';

  if(data.click){
    pointer.style.background='red';
    setTimeout(()=>pointer.style.background='white',100);

    // 실제 클릭 요소 찾기
    const target = document.elementFromPoint(x, y);
    if(target && target!==pointer) {
      target.click();
    }
  }
});
</script>
</body>
</html>
